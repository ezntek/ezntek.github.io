<!DOCTYPE HTML>
<html>
    <head>
        <meta charset="UTF-8" />
        <title>Tuluwasa Kaithifier</title>
        <meta name="color-scheme" content="dark light" />
    </head>
    <style>
        input,button,textarea {
            font-size: 1.6em;
        }
        .outdiv {
            font-size: 2.8em;
            padding: 0.5em;
        }
    </style>
    <body>
        <center>
            <h1>Tuluwasa Kaithifier 2.0</h1>
            <p>Both standard and most non-standard spellings are now supported, including numbers.</p>
            <p>Copyright Â© Eason Qin, 2025. Put under the CC BY-SA 4.0 License.</p>
            <textarea type="text" id="inputBox" placeholder="Osho!"></textarea>
            <br />
            <textarea class="outdiv" id="output"></textarea>
            <br />
            <button id="btn">Submit</button>
        </center>

        <script>
            const CONSONANTS = {
                b: "ğ‘‚¥", c: "ğ‘‚’", d: "ğ‘‚ ", f: "ğ‘‚¤", g: "ğ‘‚", h: "ğ‘‚¯",
                j: "ğ‘‚”", jj: "ğ‘‚•", k: "ğ‘‚", l: "ğ‘‚ª", m: "ğ‘‚§", n: "ğ‘‚¢",
                ng: "ğ‘‚‘", p: "ğ‘‚£", r: "ğ‘‚©", s: "ğ‘‚®", sh: "ğ‘‚¬", t: "ğ‘‚",
                th: "ğ‘‚Ÿ", ts: "ğ‘‚“", v: "ğ‘‚«", w: "ğ‘‚‡", x: "ğ‘‚", y: "ğ‘‚¨", z: "ğ‘‚”ğ‘‚º"
            };
            const VOWELS = {
                a: "ğ‘‚„", e: "ğ‘‚‰", i: "ğ‘‚†", o: "ğ‘‚‹", u: "ğ‘‚ˆ",
                ai: "ğ‘‚Š", au: "ğ‘‚Œ", ei: "ğ‘‚‰ğ‘‚†", ey: "ğ‘‚‰ğ‘‚†", oi: "ğ‘‚‹ğ‘‚†"
            };
            const NUMBERS = {
                '0':"à¥¦", '1':"à¥§", '2':"à¥¨", '3':"à¥©", '4':"à¥ª", '5':"à¥«",
                '6':"à¥¬", '7':"à¥­", '8':"à¥®", '9':"à¥¯"
            }
            const VOWEL_ENDINGS = {
                a: "\u{110B0}", i: "\u{110B2}", u: "\u{110B4}", e: "\u{110B5}", o: "\u{110B7}",
                ai: "\u{110B6}", au: "\u{110B8}", ei: "\u{110B5}ğ‘‚†", ey: "\u{110B5}ğ‘‚†",
                oi: "\u{110B7}ğ‘‚†"
            };
            const CONSONANT_CLUSTERS = ["jj", "sh", "ts", "ng", "th"];
            const VOWEL_CLUSTERS = ["ai", "ei", "ey", "oi", "au"];
            function convert(inp) {
                var buf = "";
                var s = inp.toLowerCase().trim();
                var i = 0;
                var prevCons = false;
                while (i < s.length) {
                    const ch = s[i];
                    if (ch in CONSONANTS) {
                        prevCons = true;
                        if (i + 1 < s.length) {
                            const next = s[i + 1];
                            if (next in CONSONANTS) {
                                if (CONSONANT_CLUSTERS.includes(ch + next)) {
                                    buf += CONSONANTS[ch + next];
                                    i++;
                                } else {
                                    buf += CONSONANTS[ch] + "\u{110B9}";
                                }
                                i++;
                                continue;
                            }
                        }
                        buf += CONSONANTS[ch];
                    } else if (ch in VOWELS) {
                        if (i + 1 < s.length) {
                            const next = s[i + 1]; 
                            var wordEnd = i + 1 == s.length - 1;
                            var eyCluster = wordEnd && ch + next == "ey";
                            var isCluster = next in VOWELS && VOWEL_CLUSTERS.includes(ch + next);
                            if (eyCluster || isCluster) {
                                if (prevCons) {
                                    buf += VOWEL_ENDINGS[ch + next];
                                } else {
                                    buf += VOWELS[ch + next];
                                }
                                i += 2;
                                prevCons = false;
                                continue;
                            }
                        }
                        if (prevCons) {
                            buf += VOWEL_ENDINGS[ch];
                        } else {
                            buf += VOWELS[ch];
                        }
                        prevCons = false;
                    } else if (ch in NUMBERS) {
                        buf += NUMBERS[ch];
                    } else {
                        prevCons = false;
                        buf += ch;
                    }
                    i += 1;
                }
                return buf;
            }
            const inputBox = document.getElementById("inputBox");
            const output = document.getElementById("output");
            const btn = document.getElementById("btn");
            btn.addEventListener("click", () => {
                output.textContent = convert(inputBox.value);                
            });
        </script>
    </body>
</html>
